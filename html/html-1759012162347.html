<!DOCTYPE html>
<html>
<head>
    <title>Juego de Snake</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #222;
            font-family: Arial, sans-serif;
            color: #eee;
        }
        canvas {
            background-color: #111;
            border: 5px solid #0f0;
        }
        #score {
            margin-bottom: 20px;
            font-size: 2em;
        }
        #instructions, #game-over {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: center;
        }
        #game-over {
            color: #f00;
            font-weight: bold;
            display: none; /* Hidden by default */
        }
        button {
            background-color: #0f0;
            color: #111;
            border: none;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0a0;
        }
    </style>
</head>
<body>
    <div id="score">Puntuación: 0</div>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div id="game-over">
        ¡JUEGO TERMINADO!
        <br>
        <button onclick="startGame()">Reiniciar</button>
    </div>
    <div id="instructions">
        Usa las flechas del teclado para mover la serpiente.<br>
        Presiona "Espacio" o haz clic para empezar.
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const gameOverDisplay = document.getElementById('game-over');
        const instructionsDisplay = document.getElementById('instructions');

        const gridSize = 20;
        let snake = [{ x: 10, y: 10 }];
        let food = {};
        let direction = 'right';
        let changingDirection = false;
        let score = 0;
        let gameInterval;
        let gameSpeed = 150; // Milliseconds
        let gameOver = false;
        let gameStarted = false;

        function generateFood() {
            let newFoodX = Math.floor(Math.random() * (canvas.width / gridSize));
            let newFoodY = Math.floor(Math.random() * (canvas.height / gridSize));

            // Ensure food does not spawn on the snake
            for (let i = 0; i < snake.length; i++) {
                if (snake[i].x === newFoodX && snake[i].y === newFoodY) {
                    generateFood(); // Recurse if collision
                    return;
                }
            }
            food = { x: newFoodX, y: newFoodY };
        }

        function drawObject(obj, color) {
            ctx.fillStyle = color;
            ctx.strokeStyle = 'darkgreen';
            ctx.fillRect(obj.x * gridSize, obj.y * gridSize, gridSize, gridSize);
            ctx.strokeRect(obj.x * gridSize, obj.y * gridSize, gridSize, gridSize);
        }

        function drawSnake() {
            snake.forEach(segment => drawObject(segment, 'lime'));
        }

        function drawFood() {
            drawObject(food, 'red');
        }

        function clearCanvas() {
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function updateGame() {
            if (gameOver) return;

            changingDirection = false;
            const head = { x: snake.x, y: snake.y };

            switch (direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }

            // Check for wall collision
            const hitLeftWall = head.x < 0;
            const hitRightWall = head.x >= canvas.width / gridSize;
            const hitTopWall = head.y < 0;
            const hitBottomWall = head.y >= canvas.height / gridSize;

            if (hitLeftWall || hitRightWall || hitTopWall || hitBottomWall || checkSelfCollision(head)) {
                endGame();
                return;
            }

            snake.unshift(head); // Add new head

            // Check for food collision
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreDisplay.textContent = `Puntuación: ${score}`;
                generateFood();
                // Optionally increase speed
                // gameSpeed = Math.max(50, gameSpeed - 5);
                // clearInterval(gameInterval);
                // gameInterval = setInterval(updateGame, gameSpeed);
            } else {
                snake.pop(); // Remove tail if no food eaten
            }

            drawGame();
        }

        function checkSelfCollision(head) {
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        function drawGame() {
            clearCanvas();
            drawFood();
            drawSnake();
        }

        function changeDirection(event) {
            if (changingDirection || !gameStarted) return;

            const keyPressed = event.keyCode;
            const LEFT_KEY = 37;
            const UP_KEY = 38;
            const RIGHT_KEY = 39;
            const DOWN_KEY = 40;
            const SPACE_KEY = 32;

            if (keyPressed === SPACE_KEY && !gameStarted) {
                startGame();
                return;
            }

            const goingUp = direction === 'up';
            const goingDown = direction === 'down';
            const goingLeft = direction === 'left';
            const goingRight = direction === 'right';

            if (keyPressed === LEFT_KEY && !goingRight) {
                direction = 'left';
                changingDirection = true;
            }
            if (keyPressed === UP_KEY && !goingDown) {
                direction = 'up';
                changingDirection = true;
            }
            if (keyPressed === RIGHT_KEY && !goingLeft) {
                direction = 'right';
                changingDirection = true;
            }
            if (keyPressed === DOWN_KEY && !goingUp) {
                direction = 'down';
                changingDirection = true;
            }
        }

        function startGame() {
            if (gameStarted) return;

            gameOver = false;
            gameStarted = true;
            score = 0;
            scoreDisplay.textContent = `Puntuación: ${score}`;
            snake = [{ x: 10, y: 10 }];
            direction = 'right';
            gameSpeed = 150;

            generateFood();
            clearCanvas();
            drawGame(); // Initial draw
            gameOverDisplay.style.display = 'none';
            instructionsDisplay.style.display = 'none';

            clearInterval(gameInterval); // Clear any existing interval
            gameInterval = setInterval(updateGame, gameSpeed);
        }

        function endGame() {
            gameOver = true;
            gameStarted = false;
            clearInterval(gameInterval);
            gameOverDisplay.style.display = 'block';
        }

        // Event Listeners
        document.addEventListener('keydown', changeDirection);
        canvas.addEventListener('click', () => {
            if (!gameStarted) {
                startGame();
            }
        });

        // Initial setup for display
        generateFood();
        drawGame(); // Draw initial snake and food before game starts
        gameOverDisplay.style.display = 'none'; // Ensure it's hidden on load
    </script>
</body>
</html>