<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recordatorio de Hora en Segundo Plano</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.8em;
        }
        p {
            color: #666;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        .button-group {
            margin-top: 20px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }
        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        #statusMessage {
            margin-top: 30px;
            font-weight: bold;
            color: #555;
            min-height: 1.5em; /* Previene saltos de diseño */
            font-size: 1em;
        }
        #statusMessage.error {
            color: #dc3545;
        }
        #statusMessage.success {
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Recordatorio de Hora</h1>
        <p>Esta aplicación intentará enviar notificaciones con la hora actual cada 2 segundos. Para que funcione "en segundo plano", la pestaña del navegador debe permanecer abierta. El navegador podría reducir la frecuencia de las notificaciones si la pestaña no está activa para ahorrar recursos.</p>
        <div class="button-group">
            <button id="startButton">Iniciar Recordatorios</button>
            <button id="stopButton" disabled>Detener Recordatorios</button>
        </div>
        <p id="statusMessage"></p>
    </div>

    <script>
        let notificationIntervalId = null;
        const statusMessageElement = document.getElementById('statusMessage');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');

        function updateStatus(message, type = 'info') {
            statusMessageElement.textContent = message;
            statusMessageElement.className = ''; // Reset classes
            if (type === 'error') {
                statusMessageElement.classList.add('error');
            } else if (type === 'success') {
                statusMessageElement.classList.add('success');
            }
        }

        function showTimeNotification() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            try {
                // Notificación simple sin Service Worker
                new Notification("Recordatorio de Hora", {
                    body: `Son las: ${timeString}`,
                    icon: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23007bff"%3E%3Cpath d="M0 0h24v24H0z" fill="none"%3E%3C/path%3E%3Cpath d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.22-13.41L11 7V5h1.5l.75 2.25zM12.5 13H11V7h1.5v6zm2.25-2.25L15 11.25V13h-1.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/%3E%3C/svg%3E'
                });
            } catch (error) {
                console.error("Error al mostrar la notificación:", error);
                updateStatus("Error: No se pudo mostrar la notificación. Asegúrate de que el navegador permita notificaciones y que la pestaña esté activa.", 'error');
                // stopNotifications(); // Podrías detener si hay errores persistentes
            }
        }

        async function startNotifications() {
            if (!("Notification" in window)) {
                updateStatus("Tu navegador no soporta notificaciones de escritorio.", 'error');
                startButton.disabled = true;
                return;
            }

            if (Notification.permission === "denied") {
                updateStatus("El permiso para notificaciones ha sido denegado. Por favor, habilítalo manualmente en la configuración de tu navegador para este sitio.", 'error');
                return;
            }

            if (Notification.permission === "default") {
                updateStatus("Solicitando permiso de notificación...");
                const permission = await Notification.requestPermission();
                if (permission !== "granted") {
                    updateStatus("Permiso de notificación denegado por el usuario.", 'error');
                    return;
                }
            }

            if (Notification.permission === "granted") {
                if (notificationIntervalId) {
                    clearInterval(notificationIntervalId);
                }
                updateStatus("Recordatorios iniciados. Pueden ser limitados por el navegador si la pestaña no está activa o en segundo plano.", 'success');
                showTimeNotification(); // Mostrar una inmediatamente al iniciar
                notificationIntervalId = setInterval(showTimeNotification, 2000); // Cada 2 segundos
                startButton.disabled = true;
                stopButton.disabled = false;
            } else {
                updateStatus("No se pudo obtener el permiso para notificaciones.", 'error');
            }
        }

        function stopNotifications() {
            if (notificationIntervalId) {
                clearInterval(notificationIntervalId);
                notificationIntervalId = null;
                updateStatus("Recordatorios detenidos.");
            }
            startButton.disabled = false;
            stopButton.disabled = true;
        }

        document.addEventListener('DOMContentLoaded', () => {
            startButton.addEventListener('click', startNotifications);
            stopButton.addEventListener('click', stopNotifications);

            // Comprobación inicial del estado del permiso de notificación
            if (!("Notification" in window)) {
                updateStatus("Tu navegador no soporta notificaciones de escritorio.", 'error');
                startButton.disabled = true;
            } else if (Notification.permission === "denied") {
                updateStatus("El permiso para notificaciones ha sido denegado. Habilítalo manualmente en la configuración del sitio.", 'error');
            } else if (Notification.permission === "granted") {
                updateStatus("Permiso de notificación concedido. ¡Puedes iniciar los recordatorios!");
            } else { // default
                updateStatus("Haz clic en 'Iniciar Recordatorios' para solicitar permiso y comenzar.");
            }
        });
    </script>
</body>
</html>